<!doctype html>
<html>
    <head>
        <title>easyXDM</title>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js">
        </script>
        <script type="text/javascript" src="../wrappers/jquery-cors-plugin.js">
        </script>
        <script type="text/javascript">
            if (!$.cors.isNative) {
                $.cors.defaultPath = "/easyxdm/src/cors/";
                // we need to add easyXDM
                document.write(unescape("%3Cscript src='../easyXDM.debug.js' type='text/javascript'%3E%3C/script%3E"));
                
                if (!("JSON" in this)) {
                    this.JSON = {
                        stringify: function(obj){
                            return $.getJSON(obj);
                        },
                        parse: function(str){
                            return $.parseJSON(str);
                        }
                    };
                }
            }
        </script>
        <script type="text/javascript">
            // this is only bootstrapping code
            var REMOTE = (function(){
                var remote = location.href;
                switch (location.host) {
                    case "provider.easyxdm.net":
                        location.href = remote.replace("provider", "consumer");
                        break;
                    case "easyxdm.net":
                        remote = remote.replace("easyxdm.net", "consumer.easyxdm.net");
                        break;
                    case "consumer.easyxdm.net":
                        remote = remote.replace("consumer", "provider");
                        break;
                    case "xdm1":
                        remote = remote.replace("xdm1", "xdm2");
                        break;
                }
                return remote.substring(0, remote.lastIndexOf("/"));
            }());
            
            
            function getGlossary(){
                $.cors({
                    url: REMOTE + "/../example/glossary.aspx",
                    type: "POST",
                    headers: {
                        "x-auth-token": "abcde"
                    },
                    dataType: "json",
                    data: {
                        param1: "a",
                        param2: "b"
                    },
                    success: function(json){
                        document.getElementById("response").innerHTML = json.glossary.title;
                    },
                    error: function(response){
                        console.log(response);
                    }
                });
                
            }
        </script>
    </head>
    <body>
        <div style="border:1px solid black;padding:3px">
            <div style="float:right">
                <a href="http://www.addthis.com/bookmark.php?v=250&amp;pub=xa-4a6cb9890fd71978" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]');" onmouseout="addthis_close();" onclick="return addthis_sendto();"><img src="http://s7.addthis.com/static/btn/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>
                <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js?pub=xa-4a6cb9890fd71978">
                </script>
            </div>
            <a href="http://easyxdm.net/docs/">See easyxdm.net/docs for full documentation and more examples</a>
            <br/>
            The examples are executing slower than the production build due to the extensive tracing.
        </div>
        <script type="text/javascript">
            document.write("Domain: " + location.host);
        </script>
        <!-- easyXDM.Debug.trace(msg) will output its messages to any element with the id "log" -->
        <div id="log" style="height:100px;border:1px dotted black;overflow:auto">
        </div>
        <div id="embedded">
        </div>
        <div>
            This example shows how to use easyXDM to call regular ajax/cors services (no JSONP) from remote domains.
            <br/>
            <input type="button" onclick="getGlossary()" value="Call getGlossary using the exposed method"/>
            <br/>
            Data from response:<span id="response"></span>
            <br/>
            Data from header:<span id="header"></span>
        </div>
        <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <script type="text/javascript">
            if (location.host.indexOf("easyxdm.net") !== -1) {
                try {
                    var pageTracker = _gat._getTracker("UA-9535591-3");
                    pageTracker._setDomainName(".easyxdm.net");
                    pageTracker._trackPageview();
                } 
                catch (err) {
                }
            }
        </script>
    </body>
</html>
